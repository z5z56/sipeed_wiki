<!DOCTYPE html>
<html  class="language_zh">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="MaixPy, MaixPy3, Python, Python3, MicroPython">
    <meta name="description" content="maixpy doc: 如何参与项目（开发文档）">
    <meta name="generator" content="teedoc">
    <meta name="markdown-generator" content="teedoc-plugin-markdown-parser">
        <link rel="stylesheet" href="/static/css/theme_default/prism.min.css" type="text/css"/>
        <link rel="stylesheet" href="/static/css/theme_default/viewer.min.css" type="text/css"/>
        <link rel="stylesheet" href="/static/css/theme_default/dark.css" type="text/css"/>
        <link rel="stylesheet" href="/static/css/theme_default/light.css" type="text/css"/>
        <link rel="stylesheet" href="/static/css/custom.css" type="text/css"/>
        <script src="/static/js/theme_default/split.js"></script>
        <script src="/static/js/theme_default/jquery.min.js"></script>
        <script src="/static/js/theme_default/pre_main.js"></script>
        <link rel="stylesheet" href="/static/css/search/style.css" type="text/css"/>
        <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?9cb07365544a53067c56c346c838181a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
    <title>MaixPy3 开发文档 - Sipeed Wiki</title>
</head>
<body>
    
            <div id="navbar">
                <div id="navbar_menu">
                    <a class="site_title" href="/"><img class="site_logo" src="/static/image/logo.svg" alt="sipeed wiki logo"><h2>wiki</h2></a>
                    <a id="navbar_menu_btn"></a>
                </div>
                <div id="navbar_items">
                    <div>
                        <ul id="nav_left">
<li class=""><a  href="/">首页</a></li>
<li class=""><a target="_blank" href="https://www.sipeed.com">矽速官网</a></li>
<li class="sub_items active_parent"><a >开源软件</a><ul><li class=""><a  href="/soft/maixpy/zh/">MaixPy</a></li>
<li class="active"><a  href="/soft/maixpy3/zh/">MaixPy3</a></li>
<li class=""><a  href="/soft/maixduino/zh/">MaixDuino</a></li>
<li class=""><a  href="/soft/Lichee/zh/">Lichee</a></li>
<li class=""><a  href="/soft/longan/zh/">Longan</a></li>
<li class=""><a  href="/soft/Tang/zh/index_bak.html">Tang</a></li>
</ul>
</li>
<li class="sub_items "><a >开源硬件</a><ul><li class=""><a  href="/hardware/zh/maix/index.html">Maix-I</a></li>
<li class=""><a  href="/hardware/zh/maixII/index.html">Maix-II</a></li>
<li class=""><a  href="/hardware/zh/maixIII/index.html">Maix-III</a></li>
<li class=""><a  href="/hardware/zh/maixIV/index.html">Maix-IV</a></li>
<li class=""><a  href="/hardware/zh/lichee/index.html">Lichee Pi</a></li>
<li class=""><a  href="/hardware/zh/tang/index.html">Tang</a></li>
<li class=""><a  href="/hardware/zh/longan/index.html">Longan</a></li>
</ul>
</li>
<li class="sub_items "><a >商业产品</a><ul><li class=""><a  href="/hardware/maixface/zh/">Maix Face</a></li>
</ul>
</li>
<li class="sub_items "><a >云平台</a><ul><li class=""><a target="_blank" href="https://www.maixhub.com">Maixhub 模型训练平台</a></li>
<li class=""><a target="_blank" href="https://www.maixhub.com/onlinecompiler">固件在线编译</a></li>
</ul>
</li>
<li class=""><a  href="/community.html">社区</a></li>
<li class=""><a  href="/store.html">商城</a></li>
</ul>

                    </div>
                    <div>
                        <ul id="nav_right">
<li class="sub_items "><a  href="">Language: 中文</a><ul><li class="active"><a  href="/soft/maixpy3/zh/">中文</a></li>
<li class=""><a  href="/soft/maixpy3/en/">English</a></li>
</ul></li>
</ul>

                        <ul class="nav_plugins"><li><a id="themes" class="light"></a></li></ul><ul class="nav_plugins"><li><a id="search"><span class="icon"></span><span class="placeholder">搜索</span>
                            <div id="search_hints">
                                <span id="search_input_hint">输入关键词，多关键词空格隔开</span>
                                <span id="search_loading_hint">正在加载，请稍候。。。</span>
                                <span id="search_download_err_hint">下载文件失败，请刷新重试或检查网络</span>
                                <span id="search_other_docs_result_hint">来自其它文档的结果</span>
                                <span id="search_curr_doc_result_hint">当前文档搜索结果</span>
                            </div></a></li></ul>
                    </div>
                </div>
            </div>
    
        <div id="wrapper">
            
            <div id="sidebar_wrapper">
                <div id="sidebar">
                    <div id="sidebar_title">
                        
                    </div>
                    <ul class="show">
<li class="not_active with_link"><a href="/soft/maixpy3/zh/index.html"><span class="label">什么是 MaixPy3 ？</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/soft/maixpy3/zh/origin/python.html"><span class="label">什么是 Python 编程语言？</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/origin/difference.html"><span class="label">MaixPy 与 MaixPy3 的区别</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">新手上路</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/soft/maixpy3/zh/guide/project.html"><span class="label">项目使用说明</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/guide/feedback.html"><span class="label">如何反馈问题</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/guide/participate.html"><span class="label">如何参与项目</span><span class=""></span></a></li>
</ul>
</li>
<li class="active_parent with_link"><a href="/soft/maixpy3/zh/install/index.html"><span class="label">如何安装 MaixPy3 </span><span class="sub_indicator"></span></a><ul class="show">
<li class="not_active with_link"><a href="/soft/maixpy3/zh/install/linux_x86_64/index.html"><span class="label">Linux x86_64</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/install/maixii_m2dock/index.html"><span class="label">MaixII M2dock</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/soft/maixpy3/zh/install/maixii_m2dock/introduce.html"><span class="label">芯片平台介绍</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/install/maixii_m2dock/resources.html"><span class="label">板级资源介绍</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/install/maixii_m2dock/verify.html"><span class="label">产品开箱验证</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/soft/maixpy3/zh/install/maixii_m2dock/flash.html"><span class="label">烧录系统</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/install/maixii_m2dock/drive.html"><span class="label">访问串口</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/install/maixii_m2dock/config.html"><span class="label">配置系统</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/install/maixii_m2dock/usage.html"><span class="label">上手使用</span><span class=""></span></a></li>
</ul>
</li>
</ul>
</li>
<li class="active_parent no_link"><a><span class="label">除此之外？</span><span class="sub_indicator"></span></a><ul class="show">
<li class="active with_link"><a href="/soft/maixpy3/zh/install/others/develop.html"><span class="label">MaixPy3开发文档</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/install/others/platform.html"><span class="label">如何适配更多产品</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/soft/maixpy3/zh/install/others/platform/develop_linux_x86_64.html"><span class="label">linux_x86_64</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/install/others/platform/develop_v831.html"><span class="label">v831</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/install/others/platform/develop_rv1126.html"><span class="label">rv1126</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/install/others/product.html"><span class="label">如何提交你的产品</span><span class=""></span></a></li>
</ul>
</li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">常用的开发工具</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/soft/maixpy3/zh/tools/mobaxterm.html"><span class="label">MobaXterm</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/tools/jupyter.html"><span class="label">Jupyter</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/tools/vscode.html"><span class="label">VSCode</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/tools/pyqt_rtsp.html"><span class="label">pyqt_rtsp</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/usage/index.html"><span class="label">一些使用案例</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/soft/maixpy3/zh/usage/00_hello_world.html"><span class="label">[00] 你好，世界。</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/usage/01_loop_python.html"><span class="label">[01] 写好 Python 代码</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/usage/02_blink_led.html"><span class="label">[02] 闪烁 LED 吧！</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/usage/03_key_led.html"><span class="label">[03] 按下按键开关灯</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/usage/04_display_screen.html"><span class="label">[04] 把图片显示到屏幕</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/usage/05_camera_capture.html"><span class="label">[05] 捕获摄像头一帧图片</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/usage/06_training_model.html"><span class="label">[06] 训练 AI 模型</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/usage/07_verify_model.html"><span class="label">[07] 输入图像验证模型</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">内置模块说明</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active no_link"><a><span class="label">Maix 模块</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/soft/maixpy3/zh/module/maix/display.html"><span class="label">display</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/module/maix/camera.html"><span class="label">camera</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/module/maix/rpycs.html"><span class="label">rpycs</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">Linux 模块</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/soft/maixpy3/zh/module/linux/gpio.html"><span class="label">GPIO</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/module/linux/i2c.html"><span class="label">I2C</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/module/linux/spi.html"><span class="label">SPI</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/module/linux/input.html"><span class="label">Iuput</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/module/linux/pwm.html"><span class="label">PWM</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/module/linux/uart.html"><span class="label">UART</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/module/linux/bluetooth.html"><span class="label">Bluetooth</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/module/linux/audio.html"><span class="label">Audio</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/module/linux/usb.html"><span class="label">USB</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">C 扩展模块</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active no_link"><a><span class="label">libmaix</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/soft/maixpy3/zh/module/ext/_maix.html"><span class="label">_maix</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/module/ext/_maix_display.html"><span class="label">_maix_display</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/module/ext/_maix_camera.html"><span class="label">_maix_camera</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/module/ext/_maix_nn.html"><span class="label">_maix_nn</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/module/ext/libi2c.html"><span class="label">libi2c</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active with_link"><a href="https://docs.python.org/3/library/" ><span class="label">Python3 标准库</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">常见问题</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/soft/maixpy3/zh/question/how_to_ask.html"><span class="label">如何提交你的问题?</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/question/driver_issue.html"><span class="label">驱动安装 常见问题集合</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/question/jupyter_issue.html"><span class="label">Jupyter 常见问题集合</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/soft/maixpy3/zh/question/maixpy3_issue.html"><span class="label">MaixPy3 常见问题集合</span><span class=""></span></a></li>
</ul>
</li>
</ul>

                </div>
                <div id="sidebar_splitter">
                </div>
            </div>
            <div id="article">
                <div id="menu_wrapper">
                                    <div id="menu">
                                    </div>
                                </div>
                <div id="content_wrapper">
                    <div id="content_body">
                        <div id="article_head">
                            <div id="article_title">
                                <h1>MaixPy3 开发文档</h1>
                            </div>
                            <div id="article_tags">
                                <ul></ul>
                            </div>
                            <div id="article_info">
                            <div>
                                <span class="article_author"></span><span class="article_date"></span>
                            </div>
                            <div>
                                <div id="source_link"><a href="https://github.com/sipeed/sipeed_wiki/blob/main/docs/soft/maixpy3/zh/install/others/develop.md" target="_blank">编辑本页</a></div>
                            </div>
                            </div>
                        </div>
                        <div id="article_content">
                            <p>MaixPy3 并不是为了某一款芯片平台制作的，它的初衷就是为了通过 Python 编程简化用户在嵌入式 Linux 上开发程序的过程，所以是建立在所有 Linux 设备都能使用的基础上去设计的，但由于 Sipeed 官方的能力有限，难以同时照顾所有开源硬件的同步开发，所以提供一些官方的基本芯片移植参考，方便第三方的开源爱好者提交其他芯片平台、镜像、工具推送到 MaixPy3 的环境中。</p>

<h2 id="-1">一般开发流程</h2>

<p>从 MaixPy3 仓库的 <a href="https://github.com/sipeed/MaixPy3/blob/main/setup.py">setup.py</a> 进行项目的编译。</p>

<p>对于一台 Linux X86 的个人计算机而言，我们使用如下命令进行构建。</p>

<ul>
<li>编译 <code>python3 setup.py build</code></li>
<li>清理 <code>python3 setup.py clean</code></li>
<li>安装 <code>pip3 install .</code></li>
</ul>

<pre><code class="bash language-bash">juwan@juwan-N85-N870HL:~/Desktop/v831_toolchain_linux_x86/MaixPy3$ python3 setup.py build
running build
running build_py
running egg_info
writing MaixPy3.egg-info/PKG-INFO
writing dependency_links to MaixPy3.egg-info/dependency_links.txt
writing entry points to MaixPy3.egg-info/entry_points.txt
writing requirements to MaixPy3.egg-info/requires.txt
writing top-level names to MaixPy3.egg-info/top_level.txt
writing manifest file 'MaixPy3.egg-info/SOURCES.txt'
running build_ext
juwan@juwan-N85-N870HL:~/Desktop/v831_toolchain_linux_x86/MaixPy3$ python3 setup.py clean
running clean
juwan@juwan-N85-N870HL:~/Desktop/v831_toolchain_linux_x86/MaixPy3$ pip3 install .Looking in indexes: https://pypi.tuna.tsinghua.edu.cn/simple
Processing /home/juwan/Desktop/v831_toolchain_linux_x86/MaixPy3
Requirement already satisfied: Pillow in /usr/lib/python3/dist-packages (from MaixPy3==0.2.9) (7.0.0)
Requirement already satisfied: evdev in /home/juwan/.local/lib/python3.8/site-packages (from MaixPy3==0.2.9) (1.4.0)
Requirement already satisfied: gpiod in /home/juwan/.local/lib/python3.8/site-packages (from MaixPy3==0.2.9) (1.4.0)
Requirement already satisfied: numpy in /home/juwan/.local/lib/python3.8/site-packages (from MaixPy3==0.2.9) (1.19.4)
Requirement already satisfied: opencv-python in /home/juwan/.local/lib/python3.8/site-packages (from MaixPy3==0.2.9) (4.5.1.48)
Requirement already satisfied: pyserial in /usr/local/lib/python3.8/dist-packages (from MaixPy3==0.2.9) (3.4)
Requirement already satisfied: rpyc in /home/juwan/.local/lib/python3.8/site-packages (from MaixPy3==0.2.9) (5.0.1)
Requirement already satisfied: spidev in /home/juwan/.local/lib/python3.8/site-packages (from MaixPy3==0.2.9) (3.5)
Requirement already satisfied: plumbum in /home/juwan/.local/lib/python3.8/site-packages (from rpyc-&gt;MaixPy3==0.2.9) (1.6.9)
Building wheels for collected packages: MaixPy3
  Building wheel for MaixPy3 (setup.py) ... done
  Created wheel for MaixPy3: filename=MaixPy3-0.2.9-cp38-cp38-linux_x86_64.whl size=115611 sha256=54f70f181ccc629f1eaf470bf30eccd20389c6333814d7145e16a31db7f6cdcd
  Stored in directory: /tmp/pip-ephem-wheel-cache-9bf1q3wt/wheels/53/7d/47/6cd374fab930089f96a0a3185f5677e52a9b71dbbee769935d
Successfully built MaixPy3
Installing collected packages: MaixPy3
  Attempting uninstall: MaixPy3
    Found existing installation: MaixPy3 0.2.8
    Uninstalling MaixPy3-0.2.8:
      Successfully uninstalled MaixPy3-0.2.8
Successfully installed MaixPy3-0.2.9
juwan@juwan-N85-N870HL:~/Desktop/v831_toolchain_linux_x86/MaixPy3$ 
</code></pre>

<p>而对于不能在目标平台上编译安装的环境，就需要使用预编译的 whl 包来辅助安装，以 Maix V831 为例。</p>

<ul>
<li><p>编译 <code>python3.8 setup.py maix_v831 bdist_wheel</code></p></li>
<li><p>安装 <code>pip install ./dist/*.whl</code></p></li>
</ul>

<pre><code class="bash language-bash">root@sipeed:/# pip install maixpy3 --upgrade
Collecting maixpy3
  Downloading MaixPy3-0.1.9-cp38-cp38-linux_armv7l.whl (1.0 MB)
     |████████████████████████████████| 1.0 MB 43 kB/s 
Collecting pexpect
  Downloading pexpect-4.8.0-py2.py3-none-any.whl (59 kB)
     |████████████████████████████████| 59 kB 71 kB/s 
Collecting rpyc
  Downloading rpyc-5.0.1-py3-none-any.whl (68 kB)
     |████████████████████████████████| 68 kB 42 kB/s 
Requirement already satisfied, skipping upgrade: Pillow in /usr/lib/python3.8/site-packages (from maixpy3) (7.2.0)
Collecting ptyprocess&gt;=0.5
  Downloading ptyprocess-0.7.0-py2.py3-none-any.whl (13 kB)
Collecting plumbum
  Downloading plumbum-1.6.9-py2.py3-none-any.whl (115 kB)
     |████████████████████████████████| 115 kB 84 kB/s 
Installing collected packages: ptyprocess, pexpect, plumbum, rpyc, maixpy3
Successfully installed maixpy3-0.1.9 pexpect-4.8.0 plumbum-1.6.9 ptyprocess-0.7.0 rpyc-5.0.1
WARNING: You are using pip version 20.1.1; however, version 21.0 is available.
You should consider upgrading via the '/usr/bin/python3 -m pip install --upgrade pip' command.

root@sipeed:/# 
</code></pre>

<p>对于一些安装失败，缺少了依赖库的场合，需要从外部去引入该包的安装，例如这个问题 <a href="https://github.com/sipeed/MaixPy3/issues/4">error happened when install maixpy3</a> ，这通常需要升级镜像来解决，或手动安装相关的依赖包。</p>

<p>至此以后，在发布软件包的时候可以通过 <code>pip install maixpy3</code> 让目标机器直接安装 maixpy3 的包即可使用。</p>

<h2 id="-2">一般测试流程</h2>

<p>项目引入 tox 进行软件接口交互的自动化测试，通常用它进行虚拟 Python 环境测试，确保软件代码的依赖关系和接口逻辑测试，如测试 <code>from xxx import *</code> 是否可行。</p>

<pre><code class="bash language-bash">juwan@juwan-N85-N870HL:~/Desktop/v831_toolchain_linux_x86/MaixPy3$ tox
GLOB sdist-make: /home/juwan/Desktop/v831_toolchain_linux_x86/MaixPy3/setup.py
py38 inst-nodeps: /home/juwan/Desktop/v831_toolchain_linux_x86/MaixPy3/.tox/.tmp/package/1/MaixPy3-0.1.2.zip
py38 installed: attrs==20.3.0,iniconfig==1.1.1,packaging==20.8,Pillow==8.1.0,pluggy==0.13.1,py==1.10.0,pyparsing==2.4.7,pytest==6.2.1,MaixPy3 @ file:///home/juwan/Desktop/v831_toolchain_linux_x86/MaixPy3/.tox/.tmp/package/1/MaixPy3-0.1.2.zip,scripttest==1.3,toml==0.10.2
py38 run-test-pre: PYTHONHASHSEED='820562099'
py38 run-test: commands[0] | py.test
======================================= test session starts ========================================
platform linux -- Python 3.8.5, pytest-6.2.1, py-1.10.0, pluggy-0.13.1
cachedir: .tox/py38/.pytest_cache
rootdir: /home/juwan/Desktop/v831_toolchain_linux_x86/MaixPy3
collected 5 items                                                                                  

ext_modules/_maix/example/test__maix.py .                                                    [ 20%]
tests/test_maix.py ....                                                                      [100%]

======================================== 5 passed in 0.05s =========================================
_____________________________________________ summary ______________________________________________
  py38: commands succeeded
  congratulations :)
</code></pre>

<p>对于硬件模块，通常不好自动化测试，所以会做成 example 提供。</p>

<p>关于代码覆盖性测试，暂时不做。</p>

<h2 id="-3">一般发布流程</h2>

<p>2021年02月21日 关于自动化构建，还在考虑到导入多个平台的编译链编译的问题，暂时还没有准备好。</p>

<h2 id="python">Python 模块编译说明</h2>

<p>MaixPy3 使用面向模块接口开发，链接跨平台的 Python 或 C 包，统一加载到 Python3 环境当中。</p>

<p>目前支持的 Python3 环境如下：</p>

<ul>
<li><p><a href="https://www.python.org/downloads/release/python-380/">PC x86_64 的 Pyhon3 环境</a></p></li>
<li><p><a href="https://github.com/sipeed/MaixPy3/releases/tag/20210613">Sipeed v831 的 Python3 交叉编译环境</a> (需要使用 source toolchain_v83x_linux_x86/envsetup.sh 获得链接 V831 编译链的 python3.8 环境，注意这不是本机的 Python3 环境！！！)</p></li>
</ul>

<p>通常拿到一个 Python 模块，对它的 <code>setup.py</code> 执行 <code>python setup.py build</code> 即可进行构建，它的内容通常有如下示例（只是举例）。</p>

<pre><code class="python language-python">from setuptools import setup, Extension, find_packages

_maix_module = Extension('_maix', include_dirs=['ext_modules/_maix/include'], sources=get_srcs('ext_modules/_maix'), libraries=['jpeg'])

libi2c_module = Extension('pylibi2c',  include_dirs=['ext_modules/libi2c/src'], sources=get_srcs('ext_modules/libi2c/src'))

setup(
    name='MaixPy3',
    version='0.1.2',
    license='MIT',
    author='Sipeed',
    author_email="support@sipeed.com",
    url='https://github.com/sipeed/MaixPy3',
    description="MaixPy Python3 library",
    long_description=open('README.md').read(),
    install_requires=["Pillow"],
    ext_modules=[
        _maix_module,
        libi2c_module,
    ],
    packages = find_packages(), # find __init__.py packages
    classifiers=[
        'Programming Language :: Python :: 3',
    ],
)

</code></pre>

<p>只需要关心 setup 函数的参数中 packages 、 ext_modules 定义下的模块。</p>

<ul>
<li>find_packages() 会自动寻找根目录下所有带有 <code>__init__.py</code> 的包导入到 Python3 的 site-packages 中，import 的时候就会找到它。</li>
<li>ext_modules 是需要经过编译的 C 模块。</li>
</ul>

<h2 id="python-2">通用 Python 模块开发</h2>

<p>以 maix 模块为例，完全用 Python 实现的模块需要按以下结构进行构建。</p>

<ul>
<li>maix/<code>__init__.py</code></li>
<li>maix/video.py</li>
<li>maix/xxxxx.py</li>
</ul>

<p>首先 setuptools 打包系统会找到该模块的 maix 文件夹并将其安装到 <code>site-packages/maix</code> 下，这样用户就可以在 Python3 中 <code>import maix</code> 了，注意它与 setup.py 的相对目录（<code>/maix</code>）与安装目录（<code>site-packages/maix</code>）位置保持一致。</p>

<p>如何控制 from maix import * 的内容可以看 <code>__init__.py</code> 了解。</p>

<pre><code class="python language-python">from .video import camera
from .import display

__all__ = ['display', 'video', 'camera']
</code></pre>

<p>其中 <code>__all__</code> 可以控制 import 加载的模块、对象或变量，这样一个最基本的 Python 模块就制作完成了。</p>

<p>关于编写后的测试看 <a href="https://github.com/sipeed/MaixPy3/tree/main/tests/test_maix.py">test_maix.py</a> 代码可知，关于 tox 测试框架会在最后简单说明。 </p>

<h2 id="c">关于 C 拓展模块开发</h2>

<p>以 <a href="https://github.com/amaork/libi2c">libi2c</a> 举例说明原生 C 开发的模块。</p>

<p>如果是用 C 开发就需要配合 Makefile 的规则来操作，可以直接在 MaixPy3/ext_modules/libi2c 目录下直接运行 <code>make all</code> 进行构建，此时就会得到 <code>libi2c.so \ libi2c.a \ pylibi2c.so</code> 等模块。</p>

<p>这样目标系统就可以通过 C 代码链接(-l)该 libi2c 模块执行，而 <code>pylibi2c.so</code> 模块是可以直接在 Python 里面直接 import 就可以使用的。</p>

<pre><code class="shell language-shell">juwan@juwan-N85-N870HL:~/Desktop/v831_toolchain_linux_x86/MaixPy3/ext_modules/libi2c$ python3
Python 3.8.5 (default, Jul 28 2020, 12:59:40) 
[GCC 9.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; import pylibi2c
&gt;&gt;&gt; pylibi2c
&lt;module 'pylibi2c' from '/home/juwan/Desktop/v831_toolchain_linux_x86/MaixPy3/ext_modules/libi2c/pylibi2c.cpython-38-x86_64-linux-gnu.so'&gt;
&gt;&gt;&gt; 
</code></pre>

<p>注意 <code>pylibi2c.so</code> 是经过 <code>python3 setup.py build_ext --inplace</code> 命令编译 <a href="https://github.com/sipeed/MaixPy3/tree/main/ext_modules/libi2c/src/pyi2c.c">ext_modules/libi2c/src/pyi2c.c</a> 得到的模块。</p>

<p>其中 <code>#include &lt;Python.h&gt;</code> 的是来自于系统的 <code>usr/include</code> 目录，这取决于你的编译环境。</p>

<blockquote>
  <p>注意，编译通过不代表可以运行，如果发现运行时丢失函数（undefined symbol），可以通过 ldd 查询 .so 依赖函数, 通过 nm -D 查询 .a 函数，通过 readelf -e 查询程序编译版本，有些平台可能没有 ldd 的话，就用 <code>readelf -d /bin/ls | grep "Shared library"</code> 来查看了，缺啥就往环境里补就对了。</p>
</blockquote>

<h3 id="pyxxxc-c">导入 pyXXX.c 的 C 拓展模块</h3>

<p>对于 make / gcc 的模块包以 ext_modules/xxxx 方式加入 MaixPy3 的编译环境（setup.py）， 请确保该包可以跨平台编译通过后，同步修改 <a href="https://github.com/sipeed/MaixPy3/blob/main/envs/general.py">MaixPy3/envs/general.py</a> 的 ext_modules 模块。</p>

<pre><code class="python language-python">from setuptools import Extension
from .utils import get_srcs

libi2c_module = Extension('pylibi2c',  include_dirs=[
                          'ext_modules/libi2c/src'], sources=get_srcs('ext_modules/libi2c/src'))

_maix_module = Extension('_maix', include_dirs=['ext_modules/_maix/include'],
                         sources=get_srcs('ext_modules/_maix'),
                         libraries=[
    "jpeg"
],
)

_maix_camera_module = Extension('_maix_camera', include_dirs=['ext_modules/_maix_camera/include'],
                                sources=get_srcs('ext_modules/_maix_camera'),
                                )

_maix_display_module = Extension('_maix_display', include_dirs=['ext_modules/_maix_display/include'],
                                 sources=get_srcs('ext_modules/_maix_display'),
                                 )

_maix_modules = [
    libi2c_module,
    _maix_module,
    _maix_camera_module,
    _maix_display_module
]

_maix_data_files = [

]

_maix_py_modules = [
    "numpy",
    "opencv-python3",
    "opencv-python",
    "Pillow",
    "rpyc",
    "gpiod",
    "evdev",
    "spidev",
    "pyserial"
]
</code></pre>

<p>以 _maix_module 为例，在加入编译之前，该包结构如下（目录结构可能会过时）。</p>

<ul>
<li>ext_modules/_maix</li>
<li>ext_modules/_maix/include/_maix.h</li>
<li>ext_modules/_maix/_maix.c</li>
<li>ext_modules/_maix/setup.py</li>
<li>/example/test__maix.py</li>
</ul>

<p>此时我们可以在 MaixPy3 根目录下使用 <code>python3 setup.py build</code> 调用 <a href="https://github.com/sipeed/MaixPy3/blob/main/setup.py">setup.py</a> 進行构建，默认构建 linux_x86_64 的包。</p>

<pre><code class="python language-python">#!/usr/bin/env python

"""
setup.py file for MaixPy3
"""

import sys
from setuptools import setup, Extension, find_packages

ext_modules = []
data_files = []
py_modules = []

if 'maix_v831' in sys.argv:
  sys.argv.remove('maix_v831')
  from envs.maix_v831 import _maix_modules, _maix_data_files, _maix_py_modules
else:
  from envs.general import _maix_modules, _maix_data_files, _maix_py_modules

ext_modules.extend(_maix_modules)
data_files.extend(_maix_data_files)
py_modules.extend(_maix_py_modules)

</code></pre>

<p>如果在本机 Python 编译时出现如下错误：</p>

<pre><code class="shell language-shell">ext_modules/_maix/pyCamera.c:4:10: fatal error: jpeglib.h: 没有那个文件或目录
    4 | #include "jpeglib.h"
      |          ^~~~~~~~~~~
compilation terminated.
</code></pre>

<p>运行 <code>sudo apt-get install libjpeg-dev</code> 后会在本机 usr/include 和 usr/bin 中加入 libjpeg 的模块，其他编译链同理。</p>

<p>注意 Extension 的代码的链接时的相对地址（include_dirs &amp; sources），以及本地打包时链接时缺少的（.h）文件，注意 <a href="https://github.com/sipeed/MaixPy3/tree/main/MANIFEST.in">MANIFEST.in</a> 会链接本地的文件加入 Python 模块的打包。</p>

<blockquote>
  <p>默认配置下打包中不会带入模块的（.h）文件，这会导致运行 tox 自动化打包构建模块时出错。</p>
</blockquote>

<pre><code class="in language-in">include ext_modules/libi2c/src/*.h
include ext_modules/_maix/include/*.h
</code></pre>

<blockquote>
  <p>关于 setup.py 的用法可以参考 <a href="https://frostming.com/2020/12-25/python-packaging">2021年，你应该知道的Python打包指南</a></p>
</blockquote>

<h3 id="c-2">编写 C 拓展模块的参考</h3>

<p>接下来说明 CPython 的代码编写规范说明：</p>

<ul>
<li>如何编写一个 CPython 模块（PyModule）。</li>
<li>如何 CPython 模块添加类对象（全局对象）、全局函数、全局变量。</li>
<li>一个 PyObject 类对象的结构代码。</li>
<li>标准 CPython 模块的命令规则。</li>
</ul>

<p>以 MaixPy3/ext_modules/_maix 模块为例，首先提供一个 C 实现的 Python 模块入口 <a href="https://github.com/sipeed/MaixPy3/tree/main/ext_modules/_maix/_maix.c">_maix.c</a> 。</p>

<pre><code class="c language-c">#include "_maix.h"

#define _VERSION_ "0.1"
#define _NAME_ "_maix"

PyDoc_STRVAR(_maix_doc, "MaixPy Python3 library.\n");

static PyObject *_maix_help() {
    return PyUnicode_FromString(_maix_doc);
}

static PyMethodDef _maix_methods[] = {
    {"help", (PyCFunction)_maix_help, METH_NOARGS, _maix_doc},
    {NULL}
};

void define_constants(PyObject *module) {
    PyModule_AddObject(module, "_VERSION_", Py_BuildValue("H", _VERSION_));
}

static struct PyModuleDef _maixmodule = {
    PyModuleDef_HEAD_INIT,
    _NAME_,         /* Module name */
    _maix_doc,  /* Module _maixMethods */
    -1,             /* size of per-interpreter state of the module, size of per-interpreter state of the module,*/
    _maix_methods,
};

PyMODINIT_FUNC PyInit__maix(void)
{

    PyObject *module;

    if (PyType_Ready(&amp;CameraObjectType) &lt; 0) {
        return NULL;
    }

    module = PyModule_Create(&amp;_maixmodule);
    PyObject *version = PyUnicode_FromString(_VERSION_);

    /* Constants */
    define_constants(module);

    /* Set module version */
    PyObject *dict = PyModule_GetDict(module);
    PyDict_SetItemString(dict, "__version__", version);
    Py_DECREF(version);

    /* Register CameraObjectType */
    Py_INCREF(&amp;CameraObjectType);
    PyModule_AddObject(module, Camera_name, (PyObject *)&amp;CameraObjectType);

    return module;
}


</code></pre>

<p>此时 Python 在 import 该模块的时候就会调用 PyInit_xxxx 函数进行初始化，在 Python 里 import 该模块只会执行一次，想要再次执行需要 reload 函数（<code>from imp import reload</code>）。</p>

<p>通过 <code>PyModule_AddObject</code> 注册 PyObject 对象到该模块中，而该对象被公开到一个头文件当中进行交换，从而给 PyModule 提供多个 PyObject 的实现，添加模块的全局变量与此同理。</p>

<pre><code class="c language-c">static PyMethodDef _maix_methods[] = {
    {"help", ()_maix_help, METH_NOARGS, _maix_doc},
    {NULL}
};
</code></pre>

<p>通过 <code>_maix_methods</code> 结构体为模块添加全局函数，如果你认为某个函数是公共函数，则将其放置模块顶层，表示全局公共函数。</p>

<h3 id="pyobject">PyObject 的结构参考</h3>

<p>一个基础的格式参考如下：</p>

<p>定义一个对象必要的对外引用，将模块和对象实现分离，模块再通过（.h）文件链接对象实现，可见 <a href="https://github.com/sipeed/MaixPy3/blob/main/ext_modules/_maix_camera/include/_maix_camera.h">MaixPy3/ext_modules/_maix_camera/include/_maix_camera.h</a> 。</p>

<pre><code class="c language-c">#ifndef _MAIX_CAMERA_H
#define _MAIX_CAMERA_H

#ifdef  __cplusplus
extern "C" {
#endif

#include &lt;Python.h&gt;

/* Macros needed for Python 3 */
#ifndef PyInt_Check
#define PyInt_Check PyLong_Check
#define PyInt_FromLong PyLong_FromLong
#define PyInt_AsLong PyLong_AsLong
#define PyInt_Type PyLong_Type
#endif

PyDoc_STRVAR(VirtualCamera_name, "VirtualCamera");
extern PyTypeObject VirtualCameraObjectType;

// #define V831Camera
#ifdef V831Camera
PyDoc_STRVAR(V831Camera_name, "V831Camera");
extern PyTypeObject V831CameraObjectType;
#endif

#ifdef  __cplusplus
}
#endif

#endif

</code></pre>

<p>此时（PyInit__maix）就可以加载该对象（CameraObjectType）到 _maix 模块当中。</p>

<pre><code class="c language-c">if (PyType_Ready(&amp;VirtualCameraObjectType) &lt; 0) {
    return NULL;
}

/* Register VirtualCameraObjectType */
Py_INCREF(&amp;VirtualCameraObjectType);
PyModule_AddObject(module, VirtualCamera_name, (PyObject *)&amp;VirtualCameraObjectType);

</code></pre>

<p>现在看到 PyObject 的实现参考，以 <a href="https://github.com/sipeed/MaixPy3/blob/main/ext_modules/_maix_camera/_camera_virtual.c">MaixPy3/ext_modules/_maix_camera/_camera_virtual.c</a> 为范本。</p>

<pre><code class="c language-c">PyDoc_STRVAR(VirtualCameraObject_type_doc, "VirtualCamera(width, height) -&gt; VirtualCamera object.\n");
typedef struct
{
  PyObject_HEAD;
  unsigned int width, height;
} VirtualCameraObject;

static PyGetSetDef VirtualCamera_getseters[] = {
    {"width", (getter)VirtualCamera_get_width, (setter)VirtualCamera_set_width, VirtualCamera_width_doc},
    {"height", (getter)VirtualCamera_get_height, (setter)VirtualCamera_set_height, VirtualCamera_height_doc},
    {NULL},
};

PyTypeObject VirtualCameraObjectType = {
    PyVarObject_HEAD_INIT(NULL, 0)
    VirtualCamera_name,                           /* tp_name */
    sizeof(VirtualCameraObject),                      /* tp_basicsize */
    0,                                        /* tp_itemsize */
    (destructor)VirtualCamera_free,                   /* tp_dealloc */
    0,                                        /* tp_print */
    0,                                        /* tp_getattr */
    0,                                        /* tp_setattr */
    0,                                        /* tp_compare */
    0,                                        /* tp_repr */
    0,                                        /* tp_as_number */
    0,                                        /* tp_as_sequence */
    0,                                        /* tp_as_mapping */
    0,                                        /* tp_hash */
    0,                                        /* tp_call */
    VirtualCamera_str,                                /* tp_str */
    0,                                        /* tp_getattro */
    0,                                        /* tp_setattro */
    0,                                        /* tp_as_buffer */
    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_BASETYPE, /* tp_flags */
    VirtualCameraObject_type_doc,                     /* tp_doc */
    0,                                        /* tp_traverse */
    0,                                        /* tp_clear */
    0,                                        /* tp_richcompare */
    0,                                        /* tp_weaklistoffset */
    0,                                        /* tp_iter */
    0,                                        /* tp_iternext */
    VirtualCamera_methods,                            /* tp_methods */
    0,                                        /* tp_members */
    VirtualCamera_getseters,                          /* tp_getset */
    0,                                        /* tp_base */
    0,                                        /* tp_dict */
    0,                                        /* tp_descr_get */
    0,                                        /* tp_descr_set */
    0,                                        /* tp_dictoffset */
    (initproc)VirtualCamera_init,                     /* tp_init */
    0,                                        /* tp_alloc */
    VirtualCamera_new,                                /* tp_new */
};
</code></pre>

<p>实现任何模块时需重点关注如下基本函数接口实现，忽略（Camera）前缀，且下文函数只做举例。</p>

<ul>
<li>xxxxx_new （对象构造函数）</li>
<li>xxxxx_free （对象析构函数）</li>
<li>xxxxx_init （对象初始化函数）</li>
<li>xxxxx_getseters （对象属性定义结构）</li>
<li>xxxxx_methods （对象方法定义结构）</li>
</ul>

<p>开发上遵循基本结构即可，展示 PyArg_ParseTupleAndKeywords 传递参数用法，以 Camera_init 为例，如果不想写 keyword （kwlist） 就用 PyArg_ParseTuple 函数。</p>

<pre><code class="c language-c">static int Camera_init(CameraObject *self, PyObject *args, PyObject *kwds)
{
  // default init value
  self-&gt;width = 640, self-&gt;height = 480;

  static char *kwlist[] = {"width", "height", NULL};

  if (!PyArg_ParseTupleAndKeywords(args, kwds, "|ii:__init__", kwlist,
                                   &amp;self-&gt;width, &amp;self-&gt;height))
  {
    return -1;
  }

  return 0;
}
</code></pre>

<p>为 PyObject 对象链接函数符号的时候可以看 xxxxx_getseters 和 xxxxx_methods 的结构定义。</p>

<pre><code class="c language-c">static PyMethodDef Camera_methods[] = {

    {"close", (PyCFunction)Camera_close, METH_NOARGS, Camera_close_doc},
    {"__enter__", (PyCFunction)Camera_enter, METH_NOARGS, NULL},
    {"__exit__", (PyCFunction)Camera_exit, METH_NOARGS, NULL},
    {NULL},
};

static PyGetSetDef Camera_getseters[] = {
    {"width", (getter)Camera_get_width, (setter)Camera_set_width, Camera_width_doc},
    {"height", (getter)Camera_get_height, (setter)Camera_set_height, Camera_height_doc},
    {NULL},
};
</code></pre>

<p>以 Python3 的 _maix.Camera 为例：</p>

<pre><code class="python language-python">import _maix

tmp = _maix.Camera()

print("this is method", Camera.close)

print("this is var", Camera.width)

</code></pre>

<p>一个简单的 PyCFunction 函数实现方法如下：</p>

<pre><code class="c language-c">/* str */
static PyObject *Camera_str(PyObject *object)
{
  PyObject *dev_desc = PyUnicode_FromString("Camera_str");

  return dev_desc;
}
</code></pre>

<p>如果是定义模块的全局函数则可以配置 METH_NOARGS 并移除函数参数，参考如下代码。</p>

<pre><code class="c language-c">static PyObject *_maix_help() {
    return PyUnicode_FromString(_maix_doc);
}

static PyMethodDef _maix_methods[] = {
    {"help", (PyCFunction)_maix_help, METH_NOARGS, _maix_doc},
    {NULL}
};

</code></pre>

<p>关于编写 CPython 模块的参考资料很多，这里只说明 MaixPy3 模块常用的程序设计，具体到函数的如何实现的细节就不在此赘述。</p>

<h3 id="cpython">CPython 的内存标记用法</h3>

<p>可知 Python 拥有自动回收内存的 gc 机制，但在使用 Python C/C++ API 扩展 Python 模块时，对象指针标记不当可能会导致扩展的模块存在内存泄漏，可以使用 Py_INCREF（增加） &amp; Py_DECREF（减少） 指针引用计数。</p>

<pre><code class="c language-c">Py_INCREF(ref);
......
Py_DECREF(ref); // Py_XDECREF(ref);
</code></pre>

<p>对应 Python 代码就是：</p>

<pre><code class="python language-python">ref = 1
....
del ref
</code></pre>

<p>可以理解为想要 gc 主动释放一个对象，就需要将其引用标志减少到无（0）。</p>

<p>关于标记指针的说明上有用的文章。</p>

<ul>
<li>在开发时的注意事项请查阅 <a href="https://neucrack.com/p/340">使用 C 写 Python 模块时内存回收管理，Py_INCREF() 和 Py_DECREF() 的使用方式和注意点</a></li>
<li>关于原理性的源码解析 <a href="https://www.cnblogs.com/traditional/p/13698244.html">解密Python中的垃圾回收机制</a></li>
</ul>

<p>如果你不能确定当前指针是否已经被回收，则你可以在使用前对 PyObject 结构指针进行引用计数的判断，也可以对该结构的类型做判断，从而确保可以操作该对象。</p>

<pre><code class="c language-c">assert(self-&gt;ob_refcnt &gt; 0);

PyAPI_DATA(PyTypeObject) PyBool_Type;
#define PyBool_Check(x) Py_IS_TYPE(x, &amp;PyBool_Type)

</code></pre>

<p>这样你就可以放心的操作内部创建的对象实例了。</p>

<h3 id="cpython-2">CPython 模块的编写约束</h3>

<p>因为强调面向接口编程，所以 Python 模块下的 libXXXX 模块都是在各自的仓库编译通过后，再通过 setup.py 模块定义接口之间进行链接的，有些子仓库就是这么来的。</p>

<p>也就是说不对编写代码风格做约束，但会对模块的接口做约束。</p>

<p>要求每个模块的层次关系分离，以模块（PyModule）、对象（PyObject）、方法（PyCFunction）为接口参考，有如下结构。</p>

<pre><code class="shell language-shell">+----------+         +-------------+
|          +---------+ PyCFunction | 全局函數
| PyModule |         +-------------+
|          +&lt;---+
+----------+    |
                |模块对象
             +--+-------+
             | PyObject +&lt;---+
             +----------+    |
                             |
                     +-------+-----+
                     | PyCFunction | 成员函數
                     +-------------+
</code></pre>

<p>因此请遵循该接口设计进行 Python 模块的开发。</p>

<h2 id="-4">一些额外的内容</h2>

<h3 id="bdist_wheel-wheel">使用 bdist_wheel 打包对应平台 wheel 包</h3>

<p>打包成对应平台的 wheel 的 bdist_wheel 的命令需要 setuptools 中支持。</p>

<blockquote>
  <p>而 distutils 只可以构建 bdist 包。</p>
</blockquote>

<p>bdist_wheel 是将当前代码构建的最终文件都打包好，然后在安装的时候只需要释放到具体的安装目录下就结束了，这对于一些不能进行编译工作的硬件来说是极好的。</p>

<p>确认 wheel 包是否可以被安装，只需要看名称就知道了，例如 <code>python3_maix-0.1.2-cp38-cp38-linux_x86_64.whl</code> 包，我们可以看到 <code>cp38-cp38-linux_x86_64</code> 标识。</p>

<p>pip 在安装的时候就会通过 <code>from pip._internal.utils.compatibility_tags import get_supported</code> 函数判断当前系统是否可以支持这个包，如果你改名了，它也是可以安装进去的,但能不能运行就取决于系统环境了，注意 armv7.whl 和 armv7l.whl 并不相同。</p>

<blockquote>
  <p>细节阅读 <a href="https://www.cnblogs.com/juwan/p/14250104.html">2021 年 当安装 wheel 出现 whl is not a supported wheel on this platform. 的时候</a></p>
</blockquote>

<h3 id="tox">自动化测试框架 tox 的使用说明</h3>

<p>在本机上使用 <code>pip3 install tox</code> 完成安装，接着在 MaixPy3 根目录下运行 tox 即可。</p>

<p>它会自动构建指定的 Python 虚拟测试环境，进行打包构建，安装解包的测试，最后会收集整个目录下的 <code>test_*.py</code> 的代码加入到自动测试当中，如果你不想让个别代码参与测试，你可以改名成 <code>no_test_*.py</code> 方便排除和保留文件。</p>

<p>更多请自行查阅 <a href="https://www.cnblogs.com/daniumiqi/p/12179453.html">Python 任务自动化工具 tox 教程</a> 和官方文档 <a href="tox.readthedocs.io">tox.readthedocs.io</a> 。</p>

<h3 id="v831">*关于 V831 或其他平台芯片如何使用</h3>

<p>以上文档为通用说明，使用方法差异的地方在于调用 Python 指令有所不同。</p>

<p>例如加载 V831 等其他平台的 SDK 环境后，要将上述命令中的 python3 改成对应 SDK 环境的 python3.8 用以调用交叉编译的 Python 解释器，从而完成目标 arm 平台的交叉编译，这是由 SDK 提供时决定的，其他平台统一按这个结构载入即可。</p>

<h3 id="get-pippy-python-pip">调用 get-pip.py 手动为 Python pip 安装指定包。</h3>

<p>有时候一些交叉编译里面的 Python 环境可能会缺少 pip ，如果想要安装包，就可以用这样的方式从外部装进去。</p>

<ul>
<li><code>./python3.7 get-pip.py Cython --target=../usr/lib/python3.7/site-packages/</code></li>
</ul>

<h2 id="-5">后记</h2>

<table>
<thead>
<tr>
  <th>时间</th>
  <th>备注</th>
</tr>
</thead>
<tbody>
<tr>
  <td>2021年01月10日</td>
  <td>初稿</td>
</tr>
<tr>
  <td>2021年01月11日</td>
  <td>重审</td>
</tr>
<tr>
  <td>2021年02月21日</td>
  <td>修订</td>
</tr>
<tr>
  <td></td>
  <td></td>
</tr>
</tbody>
</table>

                        </div>
                    </div>
                    <div id="previous_next">
                        <div id="previous">
                            <a href="/soft/maixpy3/zh/install/maixii_m2dock/usage.html"><span class="icon"></span><span class="label">上手使用</span></a>
                        </div>
                        <div id="next">
                            <a href="/soft/maixpy3/zh/install/others/platform.html"><span class="label">如何适配更多产品</span><span class="icon"></span></a>
                        </div>
                    </div>
                </div>
                <div id="toc">
                    <div id="toc_content">
                            
                    </div>
                </div>
            </div>
        </div>
        <a id="to_top" href="#"></a>
        <div id="doc_footer">
                        
            <div id="footer">
                <div id="footer_top">
                    <ul>
<li><a>链接</a><ul><li><a target="_blank" href="https://www.sipeed.com">Sipeed</a></li>
<li><a target="_blank" href="https://bbs.sipeed.com/">BBS 论坛</a></li>
<li><a target="_blank" href="https://maixhub.sipeed.com/">Maixhub</a></li>
<li><a target="_blank" href="https://sipeed.taobao.com/">Sipeed 淘宝</a></li>
<li><a target="_blank" href="https://github.com/neutree/teedoc">网站使用 teedoc 生成</a></li>
</ul>
</li>
<li><a>网站统计</a><ul><li><a target="_blank" href="https://tongji.baidu.com/web/welcome/ico?s=9cb07365544a53067c56c346c838181a">百度统计</a></li>
<li><a  href="/sitemap.xml">网站地图</a></li>
</ul>
</li>
<li><a>源码</a><ul><li><a target="_blank" href="https://github.com/sipeed/sipeed_wiki">文档源文件</a></li>
<li><a target="_blank" href="https://github.com/sipeed">开源项目源码</a></li>
</ul>
</li>
<li><a>关注我们</a><ul><li><a target="_blank" href="https://github.com/sipeed">github</a></li>
<li><a target="_blank" href="https://twitter.com/SipeedIO">twitter</a></li>
<li><a target="_blank" href="https://sipeed.taobao.com/">淘宝</a></li>
<li><a  href="/community.html">更多</a></li>
</ul>
</li>
<li><a>联系我们</a><ul><li><a>电话: +86 0755-27808509</a>
</li>
<li><a>商业支持: support@sipeed.com</a>
</li>
<li><a>地址: 深圳市宝安区新湖路4008号蘅芳科技办公大厦A座-2101C</a>
</li>
<li><a  href="/join_us.html">加入我们</a></li>
</ul>
</li>
</ul>

                </div>
                <div id="footer_bottom">
                    <ul>
<li><a target="_blank" href="https://www.sipeed.com">©2018-2021 深圳矽速科技有限公司</a></li>
<li><a target="_blank" href="https://beian.miit.gov.cn/#/Integrated/index">粤ICP备19015433号-1</a></li>
</ul>

                </div>
            </div>
                    </div>
</body>
<script src="/static/js/theme_default/tocbot.min.js"></script>
<script src="/static/js/theme_default/main.js"></script>
<script src="/static/js/theme_default/viewer.min.js"></script>
<script src="/static/css/theme_default/prism.min.js"></script>
<script src="/static/js/custom.js"></script>
<script src="/static/js/search/search_main.js"></script>
</html>
